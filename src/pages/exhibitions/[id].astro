---
import "../../styles/index.css";
import BaseLayout from "../../layouts/BaseLayout.astro";
import PageHero from "../../components/PageHero.astro";
import CardList from "../../components/Cards/CardList.astro";
import { exhibitions } from "../../data/exhibitions";
import { galleries } from "../../data/galleries";
import { artworks } from "../../data/artworks";
import { artists } from "../../data/artists";

export async function getStaticPaths() {
  return exhibitions.map((exhibition) => ({
    params: { id: exhibition.id },
    props: { exhibition },
  }));
}

const { exhibition } = Astro.props;

// Get the gallery for this exhibition
const gallery = galleries.find((g) => g.id === exhibition.gallery_id)!;

// Get artworks for this exhibition
const exhibitionArtworks = (exhibition.artwork_ids || [])
  .map((artworkId) => artworks.find((a) => a.id === artworkId))
  .filter(Boolean)
  .map((artwork) => {
    const artist = artists.find((a) => a.id === artwork.artist_id)!;
    return {
      id: artwork.id,
      title: artwork.title,
      category: artwork.category,
      artist: artist.name,
      imageSrc: artwork.imageUrl,
      imageAlt: artwork.title,
    };
  });
---

<BaseLayout title={`artmena / ${exhibition.title}`}>
  <div class="min-h-screen">
    <PageHero
      subtitle={`${exhibition.startDate} - ${exhibition.endDate}`}
      title={exhibition.title}
    />
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
      <div class="flex justify-center">
        <div
          class="flex flex-col w-full md:w-3/4 justify-between bg-secondary-light p-8"
        >
          <div class="w-full py-4 grid grid-cols-2 grid-rows-3 gap-8">
            <div>
              <h2 class="!text-secondary">Place</h2>
              <h3>{gallery.name}</h3>
              <h3>{gallery.location}, {gallery.country}</h3>
            </div>
            <div>
              <h2 class="!text-secondary">Date</h2>
              <h3>{exhibition.startDate} - {exhibition.endDate}</h3>
              <h3>{exhibition.openingHours}</h3>
            </div>
            <div class="span-rows-2">
              <h2 class="!text-secondary">Artists</h2>
              {
                (exhibition.artist_ids || []).map((artistId) => {
                  const artist = artists.find((a) => a.id === artistId);
                  return artist ? (
                    <a
                      href={`/artists/${artist.id}`}
                      class="hover:text-primary"
                    >
                      <h3>{artist.name}</h3>
                    </a>
                  ) : null;
                })
              }
            </div>
            <div class="span-rows-2">
              <h2 class="!text-secondary">Curators</h2>{
                (exhibition.curators || []).map((curator) => <h3>{curator}</h3>)
              }
            </div>
          </div>
          <div>
            <h1>{exhibition.title}</h1>
          </div>
        </div>
        {/* Image Section */}
        <div class={`w-1/2 aspect-square]`}>
          <img
            src={exhibition.imageUrl}
            alt={exhibition.title}
            class="w-full h-full object-cover"
            transition:name=`image-${exhibition.id}`
          />
        </div>
      </div>

      {/* Description */}
      <div class="mt-8 flex flex-col gap-2">
        <h2>About the Exhibition</h2>
        <div class="border-t border-primary py-8">
          <p class="text-secondary">{exhibition.description}</p>
          {
            exhibition.curatorStatement && (
              <div class="mt-4">
                <h3>Curator Statement</h3>
                <p class="text-secondary">{exhibition.curatorStatement}</p>
              </div>
            )
          }
        </div>
      </div>
    </div>
    {/* mini nav bar*/}
    <div class="border-t border-b border-primary">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 flex">
        <div
          id="nav-artworks"
          data-section="artworks"
          class="w-1/4 border-b-2 border-primary hover:border-primary mr-8 py-4 cursor-pointer nav-item active ps-2"
        >
          Selected Artworks
        </div>
      </div>
    </div>

    {/* Artworks section */}
    <div id="section-artworks" class="section-content">
      <CardList
        objectType="artwork"
        cards={exhibitionArtworks}
        cardsPerRow={2}
      />
    </div>
  </div>
</BaseLayout>
