---
import "../../styles/index.css";

import PageHero from "../../components/PageHero.astro";
import CardList from "../../components/Cards/CardList.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";
import { exhibitions } from "../../data/exhibitions";
import { galleries } from "../../data/galleries";

// Get current date for filtering
const currentDate = new Date();

// Filter exhibitions into current, upcoming and past based on dates
const currentExhibitionsData = exhibitions.filter((ex) => {
  const startDate = new Date(ex.startDate);
  const endDate = new Date(ex.endDate);
  return startDate <= currentDate && endDate >= currentDate;
});

const upcomingExhibitionsData = exhibitions.filter((ex) => {
  const startDate = new Date(ex.startDate);
  return startDate > currentDate;
});

const pastExhibitionsData = exhibitions.filter((ex) => {
  const endDate = new Date(ex.endDate);
  return endDate < currentDate;
});

// Transform current exhibitions for CardList component
const currentExhibitions = currentExhibitionsData.map((ex) => {
  const gallery = galleries.find((g) => g.id === ex.gallery_id)!;
  return {
    id: ex.id,
    imageSrc: ex.imageUrl,
    imageAlt: ex.title,
    title: ex.title,
    text1: `${ex.startDate} - ${ex.endDate}`,
    text2: `${gallery.location}, ${gallery.country}`,
  };
});

// Transform upcoming exhibitions for CardList component
const upcomingExhibitions = upcomingExhibitionsData.map((ex) => {
  const gallery = galleries.find((g) => g.id === ex.gallery_id)!;
  return {
    id: ex.id,
    imageSrc: ex.imageUrl,
    imageAlt: ex.title,
    title: ex.title,
    text1: `${ex.startDate} - ${ex.endDate}`,
    text2: `${gallery.location}, ${gallery.country}`,
  };
});

// Transform past exhibitions for CardList component
const pastExhibitions = pastExhibitionsData.map((ex) => {
  const gallery = galleries.find((g) => g.id === ex.gallery_id)!;
  return {
    id: ex.id,
    imageSrc: ex.imageUrl,
    imageAlt: ex.title,
    title: ex.title,
    text1: `${ex.startDate} - ${ex.endDate}`,
    text2: `${gallery.location}, ${gallery.country}`,
  };
});
---

<BaseLayout title="artmena/exhibitions" description="artmena">
  <div class="min-h-screen">
    <PageHero title="Exhibitions" />

    {/* Current Exhibitions - only show if there are current exhibitions */}
    {
      currentExhibitions.length > 0 && (
        <CardList
          objectType="exhibitions"
          title="Current Exhibitions"
          onViewAll={"exhibitions/category/current"}
          cards={currentExhibitions}
          maxRows={1}
        />
      )
    }

    {/* Upcoming Exhibitions - only show if there are upcoming exhibitions */}
    {
      upcomingExhibitions.length > 0 && (
        <CardList
          objectType="exhibitions"
          title="Upcoming Exhibitions"
          onViewAll={"exhibitions/category/upcoming"}
          cards={upcomingExhibitions}
          maxRows={1}
        />
      )
    }

    {/* Past Exhibitions - only show if there are past exhibitions */}
    {
      pastExhibitions.length > 0 && (
        <CardList
          objectType="exhibitions"
          title="Past Exhibitions"
          onViewAll={"exhibitions/category/past"}
          cards={pastExhibitions}
          maxRows={1}
        />
      )
    }
  </div>
</BaseLayout>
