---
import Card from "./Card.astro";
import { ClientRouter } from "astro:transitions";
export interface CardData {
  id?: string;
  imageSrc: string;
  imageAlt: string;
  preText?: string;
  title: string;
  description?: string;
  text1?: string;
  text2?: string;
}

interface Props {
  objectType: string;
  title?: string;
  onViewAll?: string;
  children?: React.ReactNode;
  enableScroll?: boolean;
  cardsPerRow?: number;
  maxRows?: number;
  cards: CardData[];
  imageRatio?: "square" | "4:3" | "16:9" | "3:4" | "custom";
}

const {
  objectType,
  title,
  onViewAll,
  children,
  enableScroll = false,
  maxRows,
  cards,
  cardsPerRow,
  imageRatio,
} = Astro.props;

const getMaxRowsClass = () => {
  if (!maxRows || enableScroll || maxRows > 5) return "";
  return `grid-max-rows-${maxRows}`;
};

const getMaxColsClass = () => {
  if (!cardsPerRow) return "md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4";
  return `md:grid-cols-${cardsPerRow}`;
};
---

<section class="py-8">
  <ClientRouter />
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    {/* Header with title and view all button */}
    <div class="flex items-center justify-between md:justify-start mb-6">
      <h2
        class="text-2xl font-bold text-primary md:w-1/3"
        transition:name={title}
      >
        {title}
      </h2>
      {
        onViewAll && (
          <a href={onViewAll}>
            <button class="text-secondary hover:text-primary text-sm border-l border-black hover:border-primary pl-4 transition-colors cursor-pointer">
              view all
            </button>
          </a>
        )
      }
    </div>

    {/* Card list - scrollable or grid */}
    <div class={enableScroll ? "overflow-x-auto" : ""}>
      <div
        class={enableScroll
          ? "flex space-x-4 pb-4"
          : `grid gap-4 grid-cols-1  ${getMaxRowsClass()} ${getMaxColsClass()}`}
      >
        {
          children ||
            cards.map((card, index) => (
              <div class={enableScroll ? "flex-shrink-0 w-64" : ""}>
                <Card
                  id={card.id}
                  imageSrc={card.imageSrc}
                  imageAlt={card.imageAlt}
                  preText={card.preText}
                  title={card.title}
                  text1={card.text1}
                  text2={card.text2}
                  imageRatio={imageRatio}
                  objectType={objectType}
                />
              </div>
            ))
        }
      </div>
    </div>
  </div>
</section>
